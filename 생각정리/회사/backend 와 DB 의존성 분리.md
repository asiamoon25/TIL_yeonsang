MSA : 마이크로 서비스 아키텍쳐


SOA : 서비스 지향 아키텍쳐

DB 의 의존성만 분리하려면 MSA 나 SOA 를 사용해도 된다.

하지만 대용량 트래픽을 견디게 하려면 어떻게 하는게 좋을까?

chat gpt 형에게 물어본 결과

* 데이터 베이스 분리 및 추상화
* 데이터 베이스 확장성 및 최적화
* 비동기 처리 및 메시지 큐
* 안정성 및 장애 대비
* 보안
이렇게 말해줌.

하지만 회사 플랫폼에 있는 쿠폰 같이 동기로 처리해야되는 것들이 있어서 비동기 처리 및 메시지 큐는 사용하지 못할 가능성이 높다.

이 부분에서 가져갈 수 있는 부분은 데이터 베이스 분리 및 추상화 이다.
데이터베이스 확장성은 replica 가 있지만 해당 부분은 read-only 만 되서 해당 부분의 처리는 힘들 수 있다.
⁉️ _하지만 해당 부분에서 읽기 부분만 replica 로 읽게 하고 insert,update,delete 같은 부분은 다른 DB 에서 하는 것도 좋지 않을까? 이 부분은 조금 더 생각해봐야 할 수 있다._

MSA 도 현재 상황에서는 사용하기 어렵다. MSA 는 서로 통신을 하려면 message queue 같은 녀석들을 사용해야하는데 바로 위에서 말한 동기 처리를 해야하는 로직이 있어서 사용하기에는 어려움이 있다. 
하지만 동기 처리하는 부분만 제외하고 사용하는 부분도 생각해볼 수 있다. 하지만 이렇게 하나 둘 씩 동기 처리하는 로직이 필연적으로 추가될 수 있다고 생각이 되서 message queue 의 사용은 지향해야 한다고 생각이 된다.
➡️ 만약 DB 분리를 현재 사무실에 있는 인원들이 한다고 하면 나중에 다른 사람이 와서 다른 로직이 들어갈 수 있기 때문에 최대한 원래 있던 것에서 변동이 없어야된다. 그러면 MSA 보다는 SOA 로 DB와 backend 사이에 api 를 하나 넣어서 통신하는 방향으로 하는게 적당하다.

GPT 형이 말하기로는 SOA 로도 대용량 트래픽에서 안전할 수 는 없다고는 하지만 현재 보다는 괜찮을 것으로 보인다.


## Phase 1(1단계)
이런 설계의 변경 등은 보통 단계를 두고 천천히 변경하는게 정석? 이라고 하는 거 같다.

그래서 이렇게 phase  를 나눠서 할 생각이다. (만약 하게된다면...)

이 단계에서는 5개의 고려 사항이 있다.

### 1. 요구 사항 분석 및 목표 설정
늘 블로그를 찾아보면 나오는 것들이다. 당연히 요구 사항 분석 및 목표 설정이 중요하다.

그러면 필요한 정보는 무엇이 있을까?
* 현 시스템의 이해
	당연하긴 하지만.. 가장 어려운 거일 수도 있다. 기존 DB와 시스템의 아키텍처, 코드베이스, 성능,문제점 등을 파악해야한다.
* 비즈니스 요구사항 파악
	SOA 전환을 통해 달성하고자 하는 비즈니스 목표와 요구사항을 명확하게 해야한다.
	예를 들어서 시스템을 확장한다, 유지보수를 쉽게 만들겠다, 안정성을 높이겠다 이런 것들이 있다.


### 2. 아키텍처 설계
이건 내 연차에서 할 수 없는 일이긴 한데 재미는 있어보임.

* 대상 아키텍처 도출을 해야함
	SOA 기반의 대상 아키텍처를 설계해야한다. DB 서비스 레이어, API 게이트웨이, 서비스 컴포넌트 등이 있겠다.
* 인터페이스 정의
	백엔드 시스템과 데이터 서비스 간의 인터페이스 (RESTful API) 를 정의해야함...
	API 문서 작성 비슷...
	요청 및 응답형식, 엔드포인트, 인증 메커니즘 등을 명시해야함..

### 3. 프로토타이핑 및 초기 개발
설계를 하면 당연히 해야하는게 개발이다.

* 소규모 프로토타입 개발
	작은 모듈 또는 기능을 대상으로 SOA 기반의 프로토타입을 만들어서 테스트 해봐야함.
	소단위 -> 중 -> 대 로 늘려가면서 테스트를 해야한다. 당연히 소 단계에서 개선점을 찾고 수정을 해야한다. 문제점이 안나올리는 없으니까 찾아서 해결해야한다.
* 핵심 데이터 서비스 구축
	핵심 데이터 (결제, 충전, 쿠폰..) 실 서비스에서 사용되는 부분부터 개발해서 프로토타입을 만들어야 한다. 이렇게 프로토 타입을 만들어서 어떻게 써먹을지를 정할 수 있다.

### 4. 문서화 및 기준 설정
드디어 나왔다. 
* 개발 및 운영 문서화
	중요한건 아는데 하기가 싫다... 아키텍처, 인터페이스, 코드 등 다 알만한 것들을 넣어서 문서화를 해야함...
* 코딩 및 디자인 기준
	디자인은 그 디자인이 아니다.
	일관된 코드 수준을 유지하기 위해서 코딩 규칙, 디자인 패턴, 코드리뷰 ( 제일 싫음..) 프로세스 등을 정립해야함.

### 5. 테스트 전략 수립
QA 에 넣고 돌리면 된다. 아니면 테스트 자동화를 위해서 도구 및 프레임워크를 골라서 해야되는데 Grails 를 견딜만한 녀석은 없을 듯하다.(elasticsearch apm 도 박살내는 놈임)

### 6. 리스크 관리 및 이해관계자 소통
가장 중요하다. 문서화 같은걸로 해서 100번 넘겨도 무조건 모르겠다 하고 날라오는게 무조건 있다.
그리고 예상치 못한 예외가 발생할 수 있으므로 리스크 식별 및 관리 에 관한 논의를 해야하고..
실제 사용자.. 백오피스 쪽이니까 안된다는게 있으면 갈구면 된다.
* 이해 관계자와의 지속적인 소통
	프로젝트의 진행 상황, 예상되는 문제점, 성과 등을 정기적으로 공유해야함...
	~~_No** 님이 DA 할때 엑셀에 업데이트 하던 것처럼 집요하게 해야한다._~~



-----
## Phase2(2단계)

프로토타입을 만들었으면 이제 실전이다.

### 1. 구체적인 구현
프로토타입을 만들었고 테스트까지 완료했으면 이제 실제로 만들어 볼 일만 남았다.
* 서비스 개발
	phase1 에서 설계한 아키텍처와 인터페이스에 따라 실제 서비스를 개발한다.
	이때는 당연히 DB와 통신하는 데이터 서비스, 비즈니스 로직을 처리하는 백엔드 서비스 등을 포함한다
* 데이터베이스 통합
	새로운 서비스가 기존 DB 또는 새로 설계된 DB와 효과적으로 통신하도록 한다.
	DB 마이그레이션 및 동기화 작업이 필요할 수 도 있다.

### 2. 테스트 및 검증
만들었으면 뭐다? test
* 단위 테스트 및 통합 테스트
	새로 만드는 경우에는 단위테스트만 해도 되지만 이거는 서비스 전체가 수정되는 작업이다 보니 통합적으로 전체를 테스트 해야한다.
* 부하테스트 및 성능 테스트
	이렇게 까지 고생해서 프로토타입까지 만들었는데 효율이 꽝이면 만드는데 들어간 자원과 시간이 아깝다. 실제 트래픽을 모방해서 시스템의 성능과 확장성을 테스트 해야한다.
* 보안테스트
	이전 metabase 버전에 있는 보안이슈로 크게 당한 적이 있는데 보안은 중요하다.

### 3. 배포 및 모니터링
테스트 까지 끝났으면 뭐다? 배포
* 점진적 배포
	실제 운영환경에 점진적으로 배포한다. 초기에는 제한된 사용자 도는 트래픽으로 시작해서 점차 확장할 수 있음. 이것은 배포 방식을 구글링한다면 나오는 점진적 배포 방식에 있다.
* 모니터링 및 로깅
	시스템의 상태, 성능, 오류 등을 모니터링하고 로그로 남긴다. ➡️ 빠른 대응을 위해...


### 4. 최적화 및 반복
만족하면 안되고 최적화 할게 없는지 찾아봐야 한다.
* 성능 최적화
	테스트 및 실제 운영을 통해 확인된 성능문제를 개선해야함.
	 ➡️ 코드 최적화, 캐싱 전략, 데이터베이스 튜닝 등이 있음.
* 지속적인 개선
	시스템을 지속적으로 모니터링 하고, 사용자의 피드백을 받아서 기능을 추가하거나 수정해야한다.

### 5. 문서화 및 교육
아... 또..
아주 질리는 녀석이 또 나왔지만 필요하다.
* 문서 업데이트
	시스템의 최종 구조와, 사용방법, 배포 절차등에 대한 문서를 업데이트 해야함
	 ➡️ wiki 업데이트...
* 팀 교육
	교육이라고 하지만... 그냥 발표회 하듯이 하면된다.

phase 2 는 시스템을 실제로 구현하고 운영환경에 적용하는 중요한 단계인 만큼 확실하게 해야한다.


----

## Phase 3(3단계)
거의 다 왔다.. 여기서는 별로 할 일이 없다...

### 1. 운영 및 관리
* 전체 트래픽 이전
	점진적으로 했던 배포를 서비스 전체에다가 하면된다.
* 운영자동화
	배포, 모니터링, 백업, 장애 복구 등의 운영프로세스를 자동화 해야한다.
	많은 작업을 가내수공업으로 하면 지친다...

### 2. 모니터링, 분석 및 대응
* 지속적인 모니터링
	너무 당연한 이야기 scouter 로 지속적으로 지켜보자...!
* 데이터 분석
	로그 데이터, 사용자 피드백, 성능 지표 등을 분석해서 시스템의 상태를 이해하고 개선점을 도출해야함... ➡️ 그냥 이상하면 개선하면된다.

### 3. 지속적인 개선
* 기능 추가 및 개선
	사용자의 요구 사항과 비즈니스 목표에 따라 새로운 기능을 추가하고 기존 기능을 개선
	 ➡️ 진짜 너무 당연한건데 귀찮다...
* 성능 최적화
	시스템의 성능을 지속적으로 모니터링하고, 문제가 발견되면 성능 최적화 작업을 수행..
* 보안 강화
	허가되지 않은거는 다 죽여야 한다. 새로운 보안 솔루션을 찾아서 적용하도록 한다...

### 4. 사용자 및 시장변화 대응
* 사용자 피드백 수집 및 반영
	사용자로부터 받은 피드백을 분석 -> 시스템 개선 까지 가야함...
		너무 당연한걸 계속..
* 시장 변화 모니터링
	MSA 로 가즈아!!!

### 5. 지식 공유 및 문서화
아마 SOA 로 바꾸면서 생긴 경험과 정수등을 팀 내에 공유 또는 블로그에 올리면된다.
문서화는 진짜...




이렇게 전통적인 




