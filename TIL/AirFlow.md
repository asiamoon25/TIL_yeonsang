apache airflow

### 워크플로우 오픈소스 플랫폼
* 워크플로우란?
	의존성으로 연결된 작업(Task) 들의 집합
	ETL 의 경우 Extarction > Transformation > Loading 의 작업 흐름


### 구성 및 작동 원리

구성
	1. 워크플로우 정의(DAGs)
		워크 플로우를 정의하는 핵심 구성 요소
		DAGs 는 여러 개의 작업(Task)과 이 작업들 간의 의존성을 정의
		Python 언어를 사용하여 DAGs 를 정의
	2. 작업(Tasks)
		작업은 DAG의 기본 구성 단위로, 워크플로우에서 실행되는 개별적인 작업을 나타냄.
		airflow 에는 다양한 유형의 작업을 지원하는 'Operator' 가 내장되어 있음.
			-> BashOperator, PythonOperator, EmailOperator
	3. 스케줄러
		스케줄러는 DAG 를 모니터링 하고, 스케줄에 따라 작업을 실행함.
		정의된 스케줄에 따라 DAG를 실행하며, 작업의 의존성을 관리
	4. 웹 서버
		airflow의 사용자 인터페이스를 제공
		웹 브라우저를 통해 DAG의 상태를 모니터링하고, 워크플로우를 관리 할 수 있음.
	5. 메타데이터 데이터베이스
		airflow 의 상태, DAG 의 구성 및 작업의 로그 정보 등을 저장함.
		postgreSQL, MySQL 등 다양한 데이터베이스를 사용할 수 있음.




#### 워크플로우 정의(DAGs)
1. Dag 개념
	방향성 비순환 그래프 -> 즉, 작업들은 특정 순서대로 진행되며, 순환 구조를 가지지 않음.
	워크플로우 내의 각 작업(Task) 들은 서로 의존관계를 가지며, 이러한 관계가 전체 데이터 파이프라인의 흐름을 결정함.

2. DAG 정의
	Python 언어를 사용하여 DAG를 정의함. 이는 코드를 통해 워크플로우의 구조,작업, 스케줄 등을 선언적으로 기술할 수 있다는 것을 의미
	DAG 파일 내에서는 작업의 순서, 의존성, 실행 스케줄, 리트라이 메커니즘 등을 정의할 수 있음.

3. 작업(Task) 과 Operator
	* 작업은 DAG 의 기본 실행 단위. 각 작업은 특정 작업을 수행하는 ==Operator== 로 정의됨.
	* Airflow는 다양한 유형의 Operator 를 제공함. Python Operator는 Python 함수를 실행, BashOperator 는 Bash 커맨드를 실행하는 등의 작업을 할 수 있음.

4. DAG 실행
	* DAG 는 Airflow 스케줄러에 의해 실행됨. 스케줄러는 DAG의 스케줄링 정보를 바탕으로 언제 작업을 실행할지 결정함.
	* DAG는 주기적으로 또는 특정 이벤트에 의해 트리거 될 수 있음.

5. DAG 스케줄링
	* Airflow 에서는 crontab 표현식을 사용하여 작업의 실행 빈도를 정의할 수 있음.
	* 매일 자정에 실행되는 DAG, 매주 월요일에 실행되는 DAG 등을 설정할 수 있음.

6. 의존성 관리
	* DAG 내의 작업들은 서로 의존성을 가질 수 있음. -> 한 작업이 완료된 후 다음 작업이 시작되도록 설정할 수 있음.
	* 이를 통해 데이터 처리 파이프라인의 정확한 실행 순서를 보장할 수 있음.

#### 작업 (Task)
1. 작업의 정의
	* 작업은 Operator 를 사용하여 정의됨. _Operator 는 특정 작업을 수행하는 코드임._ Pyhon 코드를 실행하는 PythonOperator , Bash 커맨드를 실행하는 BashOperator 등이 있음.

2. 작업의 구성
	* 작업은 이름, Operator, 설정 매개변수 등으로 구성됨.
	* 작업에는 다양한 매개변수를 설정할 수 있으며, 이는 작업의 실행 방식에 영향을 줌.
		 ➡️ 재시도 횟수, 재시도 지연 시간, 타임아웃 설정

3. 의존성 설정
	* 작업 간의 의존성은 DAG 내에서 설정됨. 이는 한 작업이 다른 작업에 앞서 실행되거나, 특정 작업의 완료를 기다려야 함을 의미
	 ➡️ 예를 들어 task1 >> task2 는 task1 이 완료된 후 task2 가 실행되어야 함을 나타냄.

4. 작업 실행
	* 작업은 Airflow 스케줄러에 의해 실행되며, 스케줄러는 DAG 의 스케줄과 의존성 정보를 바탕으로 작업을 실행함.


##### 특징
* 독립성
	각 작업들은 독립적으로 실행됨. 작업 간의 상호 영향을 최소화, 재시도 및 오류 처리를 간소화함.
* 재시도 오류 처리
	작업 실행 중 오류가 발생 시, 정의된 정책에 따라 재시도하거나 실패 처리를 할 수 있음.
* 로그 모니터링
	작업의 실행 상태와 로그는 airflow 에서 기록되고, 웹 인터페이스를 ㅌ
* 확장성
#### 스케줄러
**apache scheduler** 임.

1. 작업 스케줄링
	스케줄러는 정의된 DAGs를 주기적으로 확인하고 스케줄에 따라 작업(Task)를 실행함.
	DAG 들을 파싱해서 스케쥴된 작업들의 작업 간격을 확인하고 실제로 작업 명령을 워커에 전달.

2. 작업 큐 관리
	실행할 작업을 실행 큐에 넣음.  이 큐는 실행될 작업을 보관하는 장소로, 여기에 들어간 작업은 워커(Worker) 프로세스에 의해 실제로 실행됨.

3. 의존성 해결
	스케줄러는 각 작업의 의존성을 해결함. DAG를 파싱하면서 DAG에 걸려 있는 의존성을 확인하고 걸려있다면 같이 큐에 넣어줌.
	어떤 작업이 다른 작업의 완료를 기다리고 있을 때, 스케줄러는 모든 의존성이 충족될 때까지 해당 작업을 실행하지 않음.

4. 리소스 할당
	스케줄러는 시스템 리소스를 고려하여 작업을 할당
	➡️ 시스템 과부하를 방지, 작업이 효율적으로 실행 될 수 있도록 함.

**스케줄러 작동방식**
1. 주기적인 확인(검사)
	스케줄러는 정의 된 간격으로 DAGs 를 검사함. 이것은 스케줄러가 실행할 준비가 된 작업을 찾는 과정

2. 작업 예약
	작업의 의존성이 충족되면 해당 작업을 실행 큐에 넣음. 이 큐는 다른 프로세스에 의해 관리 됨.

3. 상태 갱신
	스케줄러는 작업의 상태(실행 중, 완료, 실패 등)을 메타데이터 데이터베이스에 기록함. 이 정보는 워크플로우의 상태를 추척하는데 사용됨.

4. 실행 큐 관리
	실행 큐에 있는 작업은 Executor 에 의해 처리됨. 스케줄러는 이 큐를 관리하고 , 필요한 경우 작업을 재 스케줄링함.