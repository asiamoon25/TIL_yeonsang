# CAP 이론이란?
* Consistency(일관성), Availability(가용성), Partition tolerance(분할 용인) 이라는 세 가지 조건을 모두 만족할 수 없다는 정리 => 세 가지 중 두 가지를 택하라는 것
* 분산 데이터베이스 속성에 관한 이론
![[Pasted image 20231128172243.png]]

## 분산 데이터베이스 시스템
* 데이터를 여러 대의 노드에 저장.
	* 노드 : 데이터베이스 인스턴스를 구동하는 물리적인 서버, 각 노드는 다른 노드와 서로 통신함.
	사용자가 데이터베이스에 쓰기 작업을 할 때, 데이터는 분산 데이터베이스를 구성하는 특정 노드에 쓰여지며, 사용자는 어디에 데이터가 쓰여졌는지 알지 못한다.
	사용자가 데이터를 조회할 때 요청을 받는 노드는 분산 데이터베이스 환경 내 인접한 노드를 탐색해 결과를 돌려주고, 사용자는 데이터가 어디에 저장되어 있는지 알지 못한다.
* 장점
	* 사용자 트래픽이 늘어남에 따라, 데이터베이스 관리자는 분산 데이터베이스 환경에 노드를 더함으로 쉽게 수평확장 가능.
	* 수직 확장보다 수평확장이 저렴하기 때문에 대용량 데이터와 트래픽에 효율적으로 대응 가능.

## CAP 이론

### 가용성, Availability

![[Pasted image 20231128180052.png]]
고객센터는 언제든지 연락이 가능하다. 고객은 필요한 정보를 고객센터를 통해 **언제든지** 알아낼 수 있다. 이것이 가용성.

### 일관성, Consistency
노드 끼리는 같은 정보를 공유한다. 이를 일관성이라고 한다.

### 분할 허용성, Partition tolerance
![[Pasted image 20231128180305.png]]
노드의 정보를 변경해도, 다른 노드에 예전 정보가 들어가 있을 수도 있다. 이를 분할 허용성이라고 함.

## 용어 이해

### 일관성 
* 사용자가 분산 데이터베이스 상의 어떤 노드와 통신하는 지 상관없이 같은 데이터를 조회할 수 있는 것을 의미

* 조회한 데이터는 가장 최근에 쓰여진 데이터, 만약 하나의 노드에 쓰기 작업이 이루어졌다면, 이는 모든 복제본에 반영이 되어야 한다는 것. 사용자가 어떤 노드와 통신하는 지와 상관없이 같은 데이터를 보여주게 끔 함.

* 모든 인스턴스에 변경 내용을 즉각 반영하는 것은 사실상 불가능. 일관성의 목표는 데이터의 동기화가 충분히 빨라 사용상의 문제가 없게 끔 하는 것.

* 일관성은 금융이나 개인정보와 같이 모든 사용자가 일관성있는 데이터를 조회해야할 때 중요.

### 가용성, Availablity
* 가용성이란 모든 요청이 응답을 받을 수 있어야 한다는 것을 의미

* 사용자가 읽기 작업을 하든 쓰기 작업을 하든, 심지어 작업이 실패했더라도 사용자는 응답을 받을 수 있어야 한다. 즉, 시스템이 중단되는 일 없이 언제든지 사용 가능한 상태여야함.

* 가용성은 사용자가 데이터가 일관되지 않더라도 언제든지 접근할 수 있다는 것을 의미, 예를들어 스마트폰과 PC에서 은행앱을 사용할 때 서로 잔고가 일치하지 않더라도 잔고를 조회할 수 있어야 한다.

### 분할 허용성, Partition Tolerance
* 분할이란 노드의 통신이 끊어지는 것을 의미. 즉 한 노드가 다른 노드와 통신할 수 없을 때 분할이 생겼다고 함.


### CAP 이론이란?

분산 데이터베이스 시스템은 분할이 생겼을 때 일관성과 가용성 중 하나를 희생해야 한다는 것을 의미.
데이터베이스 시스템은 반드시 네트워크 장애나 여러 이유들로 장애가 발생할 수 밖에 없다. 

### MongoDB로 보는 CP